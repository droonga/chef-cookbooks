#!/bin/bash
<% common      = node.droonga.common %>
<% engine      = node.droonga.engine %>
<% http_server = node.droonga.http_server %>

exec 2>&1

set -e
set -u

ulimit -n 20480

user="<%= http_server.user_name %>"
group="<%= http_server.group_name %>"
work_dir="$(eval "echo ~${user}")/droonga-http-server/current"

cd "$work_dir"
exec chpst -u "$user:$group" \
  "${work_dir}/bin/droonga-http-server" \
    --host "<%= common.host %>" \
    --port <%= http_server.port %> \
    --tag "<%= common.tag %>" \
    --receive-host-name <%= http_server.port %> \
    --droonga-engine-host-name <%= common.host %> \
    --droonga-engine-port <%= engine.port %> \
    --droonga-default-dataset <%= common.default_dataset %> \
    --cache-size <%= http_server.cache_size %>
